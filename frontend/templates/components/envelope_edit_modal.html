{# Modale d'édition d'une enveloppe #}
<div class="modal is-active">
    <div class="modal-background" onclick="this.closest('.modal').remove()"></div>
    <div class="modal-card">
        <header class="modal-card-head has-background-warning">
            <p class="modal-card-title">Modifier {{ envelope.name }}</p>
            <button class="delete" onclick="this.closest('.modal').remove()"></button>
        </header>
        <section class="modal-card-body">
            <form hx-put="/api/envelopes/{{ envelope.id }}"
                  hx-target=".modal"
                  hx-swap="outerHTML swap:1s"
                  hx-on::after-request="
                      if(event.detail.xhr.status === 200) {
                          setTimeout(() => document.querySelector('.modal')?.remove(), 1000);
                          document.body.dispatchEvent(new CustomEvent('envelope-updated', {detail: {id: {{ envelope.id }}}}));
                      }
                  ">
                
                <div class="field">
                    <label class="label">Nom *</label>
                    <div class="control">
                        <input class="input" type="text" name="name" value="{{ envelope.name }}" required>
                    </div>
                </div>

                <div class="field">
                    <label class="label">Objectif d'épargne (€) *</label>
                    <div class="control">
                        <input class="input" type="number" step="0.01" min="0" name="target_amount" 
                               value="{{ envelope.target_amount }}" required>
                    </div>
                </div>

                <div class="field">
                    <label class="label">Description</label>
                    <div class="control">
                        <textarea class="textarea" name="description" rows="3">{{ envelope.description or '' }}</textarea>
                    </div>
                </div>

                <div class="field">
                    <label class="label">Catégorie</label>
                    <div class="control">
                        <div class="select is-fullwidth">
                            <select name="category_id">
                                <option value="">-- Aucune --</option>
                                {% for cat in categories %}
                                <option value="{{ cat.id }}" {% if envelope.category_id == cat.id %}selected{% endif %}>
                                    {{ cat.name }}
                                </option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                </div>

                <div class="field">
                    <label class="label">Compte bancaire</label>
                    <div class="control">
                        <div class="select is-fullwidth">
                            <select name="bank_account_id">
                                <option value="">-- Espèces --</option>
                                {% for acc in bank_accounts %}
                                <option value="{{ acc.id }}" {% if envelope.bank_account_id == acc.id %}selected{% endif %}>
                                    {{ acc.name }}
                                </option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                </div>

                <div class="field">
                    <label class="checkbox">
                        <input type="checkbox" name="is_active" {% if envelope.is_active %}checked{% endif %}>
                        Enveloppe active
                    </label>
                </div>
            </form>
        </section>
        <footer class="modal-card-foot">
            <button class="button" onclick="this.closest('.modal').remove()">Annuler</button>
            <button class="button is-link" form-submit>Enregistrer</button>
        </footer>
    </div>
</div>
