{# Modal d'édition d'une transaction #}
<div class="modal is-active">
    <div class="modal-background" onclick="this.closest('.modal').remove()"></div>
    <div class="modal-card">
        <header class="modal-card-head has-background-warning">
            <p class="modal-card-title">Modifier la transaction</p>
            <button class="delete" onclick="this.closest('.modal').remove()"></button>
        </header>
        <section class="modal-card-body">
            <form hx-put="/api/transactions/htmx/{{ tx.id }}"
                  hx-target="closest .modal"
                  hx-swap="outerHTML"
                  hx-on::after-request="
                      if(event.detail.xhr.status === 200) {
                          setTimeout(() => document.querySelector('.modal')?.remove(), 800);
                      }
                  ">
                
                <div class="field">
                    <label class="label">Description *</label>
                    <div class="control">
                        <input class="input" type="text" name="description" value="{{ tx.description }}" required>
                    </div>
                </div>

                <div class="columns">
                    <div class="column">
                        <div class="field">
                            <label class="label">Montant (€) *</label>
                            <div class="control">
                                <input class="input" type="number" step="0.01" min="0" name="amount" 
                                       value="{{ tx.amount }}" required>
                            </div>
                        </div>
                    </div>
                    <div class="column">
                        <div class="field">
                            <label class="label">Date *</label>
                            <div class="control">
                                <input class="input" type="date" name="date" 
                                       value="{{ tx.date.isoformat() }}" required>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="field">
                    <label class="label">Type *</label>
                    <div class="control">
                        <div class="select is-fullwidth">
                            <select name="type" required>
                                <option value="expense" {% if tx.type == 'expense' %}selected{% endif %}>Dépense</option>
                                <option value="income" {% if tx.type == 'income' %}selected{% endif %}>Revenu</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="field">
                    <label class="label">Catégorie *</label>
                    <div class="control">
                        <div class="select is-fullwidth">
                            <select name="category_id" required>
                                <option value="">-- Choisir --</option>
                                {% for cat in categories %}
                                <option value="{{ cat.id }}" {% if tx.category_id == cat.id %}selected{% endif %}>
                                    {{ cat.name }}
                                </option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                </div>

                <div class="field">
                    <label class="label">Compte bancaire *</label>
                    <div class="control">
                        <div class="select is-fullwidth">
                            <select name="bank_account_id" required>
                                <option value="">-- Choisir --</option>
                                {% for ba in bank_accounts %}
                                <option value="{{ ba.id }}" {% if tx.bank_account_id == ba.id %}selected{% endif %}>
                                    {{ ba.name }}
                                </option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                </div>

                <div class="field">
                    <label class="label">Enveloppe (optionnel)</label>
                    <div class="control">
                        <div class="select is-fullwidth">
                            <select name="envelope_id">
                                <option value="">-- Aucune --</option>
                                {% for env in envelopes %}
                                <option value="{{ env.id }}" {% if tx.envelope_id == env.id %}selected{% endif %}>
                                    {{ env.name }}
                                </option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                </div>
            </form>
        </section>
        <footer class="modal-card-foot">
            <button class="button" onclick="this.closest('.modal').remove()">Annuler</button>
            <button class="button is-link" form-submit>Enregistrer</button>
        </footer>
    </div>
</div>
